%title #{page.real_page.title ? page.real_page.title : page.real_page.simple_name.capitalize } Â· #{site.title}
%meta(charset="utf-8")
%meta(name="viewport" content="width=device-width, initial-scale=1.0")
%meta(name="description" content="#{page.description}")
%meta(name="author" content="#{page.author}")

- pageStyle = page.style ;

- if site.profile.eql?("staging") or site.profile.eql?("production")
  %link(href="#{pageStyle ? site[pageStyle].bootstrap_css_url : site.bootstrap_css_url}#{site.minified}.css" rel="stylesheet" media="screen")
- else
  %link(rel="stylesheet/less" type="text/css" href="#{pageStyle ? site[pageStyle].bootstrap_css_url : site.bootstrap_css_url}#{site.minified}.less")


/ IE 6-8 support of HTML 5 elements
/[if lt IE 9]
  %script(src="#{site.jborg_js_url}/libs/html5/pre3.6/html5.min.js")

/ Defines the project favicon. Change these URLs to your specific project folder on static.jboss.org.

%link(rel="shortcut icon" href="#{site.project_images_url}/favicon.ico")
%link(rel="apple-touch-icon-precomposed" sizes="144x144" href="#{site.project_images_url}/apple-touch-icon-144x144-precomposed.png")
%link(rel="apple-touch-icon-precomposed" sizes="114x114" href="#{site.project_images_url}/apple-touch-icon-114x114-precomposed.png")
%link(rel="apple-touch-icon-precomposed" sizes="72x72" href="#{site.project_images_url}/apple-touch-icon-72x72-precomposed.png")
%link(rel="apple-touch-icon-precomposed" href="#{site.project_images_url}/apple-touch-icon-precomposed.png")

/ Defines the project banner. Change these URLs to your specific project folder on static.jboss.org
:css
  @media (min-width: 980px) {
    .banner { background-image: url(#{site.project_images_url}/#{site.project}-banner-1180px.png); height: 110px;  }
  }
  @media (max-width: 979px) {
    .banner { background-image: url(#{site.project_images_url}/#{site.project}-logo.png); background-repeat:no-repeat; height: 60px; }
  }
  @media (max-width: 650px) {
    .banner { width: 200px; margin: 0px auto; }
  }

%script(src="#{site.jborg_js_url}/libs/jquery/jquery-1.9.1#{site.minified}.js")
- if page.javascripts
  - page.javascripts.each do |javascript|
    %script{:src=>javascript, :type=>'text/javascript'}

- if !(site.profile.eql?("staging") or site.profile.eql?("production"))
  %script(src="/javascripts/less-1.4.1.min.js")

:javascript
  //<![CDATA[

  // Function checks SessionStorage if there is cached content, validates its age
  // and optionally downloads again from the REST service and then caches it.
  function renderTabzilla() {

    var valueFromCache = null;
    if (window.sessionStorage && window.sessionStorage.getItem("#{site.project}TabzillaCache") ) {

      var temp = JSON.parse(window.sessionStorage.getItem("#{site.project}TabzillaCache"));

      // Checking if the item in cache is not older than 1 day
      if ( new Date() - new Date(Date.parse(temp.cachedDate)) < (1000*60*60*24) ) {
        valueFromCache = temp;
      }

    }

    // If nothing was found in cache then we gather all the data from scratch.
    if (valueFromCache==null) {

      // Getting information in what products the project is supported in.
      var data = $.ajax({url:"http://rysiek.apiary.io/v1/rest/products/supported/#{site.project_name}",
        dataType:'json'
      });

      // Getting HTML tab content from remote source.
      var wrapper = $.ajax({url:"http://static.jboss.org/partials/tabcontent.html",
        dataType:'html'
      });

      // When both results are available we continue with actual rendering of the data.
      $.when( data , wrapper ).then( function( dataResult , wrapperResult ) {

        var data = dataResult[0];
        var content = wrapperResult[0];
        var htmlContent;

        // Depending on whether the project is supported in any product or not,
        // we render different html entry.
        if (data.total>0) {

          htmlContent = $(content).find('#supported');
          htmlContent.find("#project_name").html("#{site.project_name}");
          var firstUl = htmlContent.find("#products-first-column");
          var secondUl = htmlContent.find("#products-second-column");

          var firstColumnSize = Math.ceil(data.total/2);
          $.each(data.hits , function(index, value) {
            if (index<firstColumnSize) {
              firstUl.html(firstUl.html()+'<li class="leaf"><a href="'+value.url+'">'+value.name+'</a></li>');
            } else {
              secondUl.html(secondUl.html()+'<li class="leaf"><a href="'+value.url+'">'+value.name+'</a></li>');
            }
          });

          $(".tabcontent").html(htmlContent);

        } else {

          htmlContent = $(content).find("#nonsupported");
          htmlContent.find("#project_name").html("#{site.project_name}");
          $(".tabcontent").html(htmlContent);

        }

        // Putting the whole generated HTML into SessionStorage.
        if (window.sessionStorage && htmlContent) {
          var entry = new Object();
          entry.cachedDate = new Date();
          entry.htmlContent = htmlContent.html();
          window.sessionStorage.setItem("#{site.project}TabzillaCache",JSON.stringify(entry));
        }

      });

    } else {

      $(".tabcontent").html(valueFromCache.htmlContent);

    }
  }

  window.addEventListener('load', function() { renderTabzilla() }, false)

  //]]>

